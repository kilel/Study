<html>
<title>Методические указания</title>
<head><H2 ALIGN=CENTER>Методические указания к работе №4</H2></head>

<body BGCOLOR="#FF0FFF" TEXT="#000000" LINK="#FF0000" ALINK="A52A2A">

<H3>Теоретическая часть</H3>
Работая на компьютере, пользователю постоянно приходиться вводить с клавиатуры команды и данные. 
Работой клавиатуры управляет специальная электронная схема - контроллер клавиатуры. В его функции входит
распознавание нажатой клавиши и помещение закреплённого за ней кода в свой выходной регистр (порт), обычно с номером 60h. 
Код клавиши, поступающий в порт, называется скен-кодом и является, по существу, порядковым номером клавиши, хотя последовательность 
скен-кодов не всегда совпадает с порядком расположения клавиш на клавиатуре. При этом каждой клавише присвоены два скен-кода, 
отличающихся друг от друга на 80h. Один скен-код (меньший, код нажатия) засылается контроллером в порт 60h при нажатии клавиши, 
другой (больший, код отпускания) - при её отпускании. Скен-код однозначно указывает на нажатую клавишу, однако по нему нельзя определить,
 работает ли пользователь на нижнем или верхнем регистре, а также вводит ли он латинские или русские буквы. С другой стороны, скен-коды присвоены
 всем клавишам клавиатуры, в том числе управляющим клавишам. Таким образом, очевидно, что определение введённого символа должно включать
 в себя не только считывание скен-кода нажатой клавиши, но и выяснение того, не были ли перед этим нажаты, например, клавиши Shift или CapsLock. 
Всем этим анализом занимается программа обработки прерываний от клавиатуры.
<P>Нажатие, а также отпускание любой клавиши вызывает сигнал аппаратного прерывания, заставляющий процессор прервать выполняемую
 программу и перейти на программу обработки прерываний (ПОП) от клавиатуры. Эта программа хранится по фиксированному адресу в постоянном
 запоминающем устройстве BIOS, являясь, таким образом, элементом "встроенного " или "зашитого" программного обеспечения.</P>
<P>Процессор вместе с сигналом прерывания получает ещё и номер вектора прерывания. За клавиатурой закреплён вектор с номером 09h. Адрес программы
 обработки прерываний от клавиатуры располагается, таким образом, в векторе 09h, занимающем два слова с адресами 24h и 26h.                                                                                                               
<P>Программа INT 09h, помимо порта 60h, работает ещё с двумя областями оперативной памяти: кольцевым буфером ввода, располагаемым по адресам
 от 40h:1Eh до 40h:3Dh, куда помещаются коды ASCII нажатых клавиш, и словом состояния клавиатуры, находящимся по адресу 40h:17h, где фиксируется
 состояние управляющих клавиш.
<P>Программа INT 09h, получив управление в результате прерывания от клавиатуры, считывает из порта 60h скен-код и анализирует его значение.
 Если скен-код принадлежит одной из управляющих клавиш, и, к тому же, представляет собой код нажатия, в слове флагов клавиатуры устанавливается бит,
 соответствующий нажатой клавише. Биты флагов сохраняют своё состояние пока клавиши остаются нажатыми. Если клавиша отпускается программа INT 09h 
получает код отпускания и сбрасывает соответствующие биты с слове флагов. 
<P>При нажатии любой другой клавиши программа INT 09h считывает её скен-код нажатия и по таблице трансляции скен-кодов в коды ASCII формирует
двухбайтовый код, старший байт содержит скен-код, а младший - код ASCII. Код ASCII определяет закреплённый за клавишей символ. Каждому скен-коду соответствует,
 как правило, два кода ASCII, так как за каждой клавишей закреплено не менее двух символов.
<P>Полученный в результате трансляции код засылается программой INT09h в кольцевой буфер ввода, который служит для синхронизации процессов ввода данных с
 клавиатуры и приёма их выполняемой компьютером программой. Объём кольцевого буфера составляет 15 слов, при этом дисциплина его обслуживания такова,
 что коды символов извлекаются из него в том же порядке, в каком поступали. За состоянием буфера следят два указателя. В хвостовом указателе  (по адресу  40:1Ch)
  хранится адрес первой свободной ячейки, в головном (по адресу 40:1Ah) - адрес самого старого кода, принятого с клавиатуры и ещё не востребованного программой.
 В начале работы, когда буфер пуст, оба указателя указывают на первую ячейку буфера. Каждое последующее нажатие добавляет в буфер очередной двухбайтовый код 
и смещает хвостовой указатель.
<P>Выполняемая программа, желая получить код нажатой клавиши, должна вызвать прерывание INT 16h, которое активизирует драйвер клавиатуры BIOS. 
Драйвер считывает из кольцевого буфера содержимое ячейки, адрес которой находиться в головном указателе, и увеличивает этот адрес на 2. Таким образом,
 программный запрос на ввод с клавиатуры фактически выполняет приём кода не с клавиатуры, а из кольцевого буфера.
<H3>Порядок выполнения работы</H3>
<P>1.Ознакомиться с теоретическим материалом, приведённым в методических указаниях.
<P>2.Запустить на выполнение пример и ознакомиться с демонстрационными программами.
<P>3.Получить у преподавателя номер варианта и задание по нему, которое приведено в лабораторном комплексе.
<P>4.Разработать предварительный алгоритм программы.
<P>5.В текстовом редакторе  ввести текст исходной программы.
<P>6.Запустить на выполнение программу TASM.EXE, если есть ошибки, то вернуться к пункту 4.
<P>7.Запустить на выполнение программу TLINK.EXE, если есть ошибки, то вернуться к пункту 4.
<P>8.Запустить на выполнение программу TD.EXE, если есть ошибки, то вернуться к пункту 4.
<P>9. Получить контрольные вопросы.
<P>10.Подготовить ответы на вопрсы.
<P>11.Оформить отчёт.
<P>12.Защитить лабораторную работу.
